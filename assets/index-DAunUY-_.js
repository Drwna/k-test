import{U as x,V as U,W as V,X as M,Y as $,r as w,y as z,w as G,v as B,Z as H,d as P}from"./index-DOWG_QFa.js";function T(e){return x()?(U(e),!0):!1}function K(e,t){if(typeof Symbol<"u"){const n={...e};return Object.defineProperty(n,Symbol.iterator,{enumerable:!1,value(){let r=0;return{next:()=>({value:t[r++],done:r>t.length})}}}),n}else return Object.assign([...t],e)}function _(e){return typeof e=="function"?e():B(e)}const y=typeof window<"u"&&typeof document<"u",X=typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope,Y=Object.prototype.toString,Z=e=>Y.call(e)==="[object Object]",I=()=>{};function q(e){const t=Object.create(null);return n=>t[n]||(t[n]=e(n))}const J=/-(\w)/g,Q=q(e=>e.replace(J,(t,n)=>n?n.toUpperCase():""));function ee(...e){if(e.length!==1)return V(...e);const t=e[0];return typeof t=="function"?M($(()=>({get:t,set:I}))):w(t)}function te(e,t=1e3,n={}){const{immediate:r=!0,immediateCallback:f=!1}=n;let a=null;const i=w(!1);function p(){a&&(clearInterval(a),a=null)}function d(){i.value=!1,p()}function l(){const o=_(t);o<=0||(i.value=!0,f&&e(),p(),a=setInterval(e,o))}if(r&&y&&l(),z(t)||typeof t=="function"){const o=G(t,()=>{i.value&&y&&l()});T(o)}return T(d),{isActive:i,pause:d,resume:l}}function le(e={}){const{inheritAttrs:t=!0}=e,n=H(),r=P({setup(a,{slots:i}){return()=>{n.value=i.default}}}),f=P({inheritAttrs:t,setup(a,{attrs:i,slots:p}){return()=>{var d;n.value;const l=(d=n.value)==null?void 0:d.call(n,{...ne(i),$slots:p});return t&&(l==null?void 0:l.length)===1?l[0]:l}}});return K({define:r,reuse:f},[r,f])}function ne(e){const t={};for(const n in e)t[Q(n)]=e[n];return t}function oe(e){var t;const n=_(e);return(t=n==null?void 0:n.$el)!=null?t:n}const re=y?window:void 0;function ue(...e){let t,n,r,f;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,r,f]=e,t=re):[t,n,r,f]=e,!t)return I;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const a=[],i=()=>{a.forEach(o=>o()),a.length=0},p=(o,s,b,m)=>(o.addEventListener(s,b,m),()=>o.removeEventListener(s,b,m)),d=G(()=>[oe(t),_(f)],([o,s])=>{if(i(),!o)return;const b=Z(s)?{...s}:s;a.push(...n.flatMap(m=>r.map(h=>p(o,m,h,b))))},{immediate:!0,flush:"post"}),l=()=>{d(),i()};return T(l),l}const F="ping";function k(e){return e===!0?{}:e}function ae(e,t={}){const{onConnected:n,onDisconnected:r,onError:f,onMessage:a,immediate:i=!0,autoClose:p=!0,protocols:d=[]}=t,l=w(null),o=w("CLOSED"),s=w(),b=ee(e);let m,h,g=!1,A=0,S=[],C;const D=()=>{if(S.length&&s.value&&o.value==="OPEN"){for(const u of S)s.value.send(u);S=[]}},N=()=>{clearTimeout(C),C=void 0},E=(u=1e3,c)=>{!y||!s.value||(g=!0,N(),m==null||m(),s.value.close(u,c),s.value=void 0)},j=(u,c=!0)=>!s.value||o.value!=="OPEN"?(c&&S.push(u),!1):(D(),s.value.send(u),!0),W=()=>{if(g||typeof b.value>"u")return;const u=new WebSocket(b.value,d);s.value=u,o.value="CONNECTING",u.onopen=()=>{o.value="OPEN",n==null||n(u),h==null||h(),D()},u.onclose=c=>{if(o.value="CLOSED",r==null||r(u,c),!g&&t.autoReconnect){const{retries:v=-1,delay:O=1e3,onFailed:R}=k(t.autoReconnect);A+=1,typeof v=="number"&&(v<0||A<v)||typeof v=="function"&&v()?setTimeout(W,O):R==null||R()}},u.onerror=c=>{f==null||f(u,c)},u.onmessage=c=>{if(t.heartbeat){N();const{message:v=F}=k(t.heartbeat);if(c.data===v)return}l.value=c.data,a==null||a(u,c)}};if(t.heartbeat){const{message:u=F,interval:c=1e3,pongTimeout:v=1e3}=k(t.heartbeat),{pause:O,resume:R}=te(()=>{j(u,!1),C==null&&(C=setTimeout(()=>{E(),g=!1},v))},c,{immediate:!1});m=O,h=R}p&&(y&&ue("beforeunload",()=>E()),T(E));const L=()=>{!y&&!X||(E(),g=!1,A=0,W())};return i&&L(),{data:l,status:o,close:E,send:j,open:L,ws:s}}export{le as c,ae as u};
